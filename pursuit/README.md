# Pursuit Robotics Autoware Stack: Build and Development Environment

This repository provides the build environment and necessary tooling to develop, build, and deploy the Pursuit Robotics Autoware Stack. It extends the Autoware Foundation's build system, enabling a streamlined development workflow on a native operating system (NOS).

This project is a fork of the official Autoware repository. We will periodically merge changes from the upstream Autoware community to incorporate the latest features and bug fixes. All proprietary changes and customizations will be isolated within the `pursuit` directory. The primary development and build activities are orchestrated from this directory.

## Target Audience

This document is intended for software engineers and developers actively contributing to the Pursuit Robotics Autoware Stack.

## High-Level Architecture

The Pursuit Robotics Autoware Stack is built upon the Robot Operating System 2 (ROS 2) and the Autoware Foundation's open-source autonomous driving software. This repository provides a set of Makefiles, scripts, and configurations to manage the build process and development environment.

The core components of this build environment are:

- **Make-based Build System:** A `Makefile` within the `pursuit` directory orchestrates the entire build process.
- **colcon:** The primary build tool for ROS 2, used to build the Autoware workspace.
- **rosdep:** A command-line tool for installing system dependencies for ROS packages.
- **vcs:** A tool for importing and managing the various git repositories that make up the Autoware source code.
- **.repos Files:** These files define the specific versions of the various git repositories that constitute the Autoware source code.

## Autoware Workspace

The Autoware project uses a workspace-based development approach. The workspace is comprised of the following directories, which are created and managed by the build system:

Note: the following directories are not tracked by git. They are explicit opt-out via the .gitignore. These are strictly staged directories used by the autoware codebase, including our proprietary components, libraries, and tools.

- `src/`: Contains the source code for all the Autoware ROS 2 packages, imported using the `vcs` tool. This directory is not tracked by git.
- `build/`: Holds intermediate files generated by the build process.
- `install/`: Contains the final, installed version of all the packages.
- `log/`: Contains logs generated by `colcon` during the build process.

## Pursuit Robotics Codebase Structure

Note: we use the pursuit shorthand for pursuit robotics.

The `pursuit` directory is the primary working directory for developers. It contains the following:

- `data/`: Contains sample data for testing and simulation.
- `docs/`: Contains project documentation.
- `infra/`: Contains infrastructure-related scripts and configurations.
- `tools/`: Contains custom tools for the project.
- `Makefile`: Defines the main build tasks.
- `*.repos`: Files that define the git repositories for the Autoware source code.

## Development Workflow

All commands should be run from the `pursuit` directory.

### 1. Prerequisites

Ensure the following tools are installed on your Ubuntu 22.04 (Jammy) development machine:

- Git
- Python 3
- Docker and Docker Compose
- pnpm and fnm

The `infra/scripts/nos_setup.sh` script can be used as a reference for installing these prerequisites.

### 2. Development Environment Setup

To set up the development environment, execute the following command from the `pursuit` directory:

In general, we have 3 target build environments used for staging. These include:
1. Native OS, also known as Bare Metal.  This basically means, any tools, libaries, or frameworks installed will be injected and layered atop of your exising os environment. Doing so may risk corrupting or breaking your operating environment.  
2. Monolithic Container - The build and deploiyment appratus will be using docker images. 
3. Non-monolithic Contoainers - This is the modernizaton approach. The framework that underlyies this behavior is called Autoware OpenAD Kit.

### Building the NOS Environment

```bash
make nos-setup-dev-no-cuda
```

This command will install all the necessary dependencies and tools required to build the Autoware stack.

#### 1. Workspace Creation

Create the Autoware workspace by running the following command from the `pursuit` directory:

```bash
make nos-workspace-autoware
```

This will check out the Autoware source code into the `src/` directory, based on the repositories defined in the `.repos` files.

#### 2. Dependency Installation

Install the ROS 2 dependencies for the Autoware packages using `rosdep`:

```bash
make nos-ros-deps
```

#### 3. Building the Autoware Stack

Compile the Autoware source code using `colcon`:

```bash
make nos-build
```

#### 4. Verification

To verify the build, launch the planning simulator:

```bash
make launch-planning-simulator
```

Refer to the `LAUNCH.md` file for more detailed information on launching various simulation and testing scenarios.

### Building the Monolithic Docker Images

### Building the Non-monolithic Docker Images